<div class="text-gray-800 simple-calendar max-w-7xl mx-auto bg-white rounded-2xl shadow-md border border-neutral-200 p-6">
  <!-- Header -->
  <div class="flex flex-col md:flex-row md:items-center md:justify-between gap-4 mb-6">
    <time
      datetime="<%= start_date.strftime('%Y-%m') %>"
      class="text-2xl font-bold text-brand"
    >
      <%= t('date.month_names')[start_date.month] %> <%= start_date.year %>
    </time>
    <nav class="flex items-center gap-2 text-sm">
      <%= link_to t('simple_calendar.previous', default: 'Previous'),
        calendar.url_for_previous_view,
        class: "px-4 py-2 rounded-lg border border-neutral-300 hover:bg-neutral-100" %>

      <%= link_to t('simple_calendar.today', default: 'Today'),
        calendar.url_for_today_view,
        class: "px-4 py-2 rounded-lg bg-brand text-black font-medium hover:underline" %>

      <%= link_to t('simple_calendar.next', default: 'Next'),
        calendar.url_for_next_view,
        class: "px-4 py-2 rounded-lg border border-neutral-300 hover:bg-neutral-100" %>
    </nav>
  </div>

  <!-- Calendar Table -->
  <div class="overflow-x-auto ">
    <table class="w-full table-fixed border-separate border-spacing-2">
      <thead>
        <tr>
          <% date_range.slice(0, 7).each do |day| %>
            <th class="py-2 text-center text-sm font-semibold text-neutral-600">
              <%= t('date.abbr_day_names')[day.wday] %>
            </th>
          <% end %>
        </tr>
      </thead>

      <tbody>
        <% date_range.each_slice(7) do |week| %>
          <tr>
            <% week.each do |day| %>
              <% 
                is_past = day < Date.current
                is_today = day == Date.current
                
                # Admin view: check if there are ANY timeslots on this day
                has_timeslots = Timeslot.where(date: day).exists?
                
                # Check if there are any reservations on this day
                has_reservations = Reservation.joins(timeslot_x_table: :timeslot).where(timeslots: { date: day }).exists?
                
                # Check if there are available slots on this day
                has_available_slots = TimeslotXTable.joins(:timeslot).where(timeslots: { date: day }, status: 'available').exists?
              %>
              
              <%= content_tag :td, class: "h-full align-middle" do %>
                <div 
                  data-date="<%= day.iso8601 %>"
                  onclick="viewDayDetails(this.dataset.date)"
                  class=" flex flex-col items-center justify-center h-full
                  min-h-24 rounded-xl p-3 border hover:bg-amber-200 transition cursor-pointer
                  <%= 'bg-brand/10 border-brand' if is_today && !has_timeslots %>
                  <%= 'bg-neutral-50 border-neutral-200' if !is_today && !has_timeslots %>
                  <%= 'opacity-30' if is_past %>
                  <%= 'bg-blue-400/30 border-blue-500' if has_timeslots && !has_reservations %>
                  <%= 'bg-orange-400/30 border-orange-500' if has_reservations %>
                  <%= 'bg-green-300/30 border-green-500' if has_available_slots && !has_reservations %>
                  ">
                  <div 
                    class="text-xs font-semibold text-center align-middle
                    <%= is_today ? 'text-brand' : 'text-neutral-500' %>">
                    <%= day.day %>
                  </div>
                  
                  <% if has_timeslots %>
                    <div class="text-[10px] text-center text-purple-500 mt-1">
                      <%= Timeslot.where(date: day).count %> slots
                    </div>
                  <% end %>
                  <% if has_reservations %>
                    <div class="text-[10px] text-center text-red-600 mt-1">
                      <%= Reservation.joins(timeslot_x_table: :timeslot).where(timeslots: { date: day }).count %> reservations
                    </div>
                  <% end %>
                </div>
              <% end %>
            <% end %>
          </tr>
        <% end %>
      </tbody>
    </table>
  </div>

  <!-- Admin Legend -->
  <div id="calendar-legends" class="flex justify-around items-center mt-5 flex-wrap gap-4">
    <div class="flex flex-row space-x-2 items-center">
      <div class="bg-blue-400 rounded-full w-5 h-5"></div>
      <span class="text-sm">Timeslots created</span>
    </div>
    <div class="flex flex-row space-x-2 items-center">
      <div class="bg-green-300 rounded-full w-5 h-5"></div>
      <span class="text-sm">Available slots</span>
    </div>
    <div class="flex flex-row space-x-2 items-center">
      <div class="bg-orange-400 rounded-full w-5 h-5"></div>
      <span class="text-sm">Has reservations</span>
    </div>
  </div>
</div>